<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Base64 Converter</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <script id="Utils">
        const validURL = (str) => {
            var pattern = new RegExp('^(https?:\\/\\/)?' + // protocol
                '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|' + // domain name
                '((\\d{1,3}\\.){3}\\d{1,3}))' + // OR ip (v4) address
                '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*' + // port and path
                '(\\?[;&a-z\\d%_.~+=-]*)?' + // query string
                '(\\#[-a-z\\d_]*)?$', 'i'); // fragment locator
            return !!pattern.test(str);
        }
    </script>
    <style>
        #Converter {
            margin-left: 30%;
            margin-top: 3%;
        }

        textarea {
            padding: 10px;
            resize: none;
            line-height: 1.5;
            border-radius: 5px;
            border: 1px solid #ccc;
            box-shadow: 1px 1px 1px #999;
        }

        .x {
            width: 50%;
        }
    </style>
</head>

<body>
    <div id="Converter">
        <h5>Selecione o arquivo</h5>
        <input type="file" id="arquivoUpload" name="arquivoUpload">
        <br>
        <h5>Insira a URL</h5>
        <input class="w3-input w3-border w3-round-large x" type="url" id="urlArquivo" name="urlArquivo"
            placeholder="Url do arquivo"></p>
        <button id="ConverterBtn">Converter</button>
        <br>
        <br>
        <textarea name="Text1" id="Result" cols="80" rows="5"></textarea>
        <br>
        <button id="copyClipboard" style="margin-top: 1%;">Copiar para o clipboard</button>
        <button id="OpenImage">Visualizar Base64</button>
        <br>
        <br>
        <p id="copiado"></p>
        <br>
        <!-- <img id="blah" src="#" alt="your image" /> -->
    </div>
    <script id="backendConverter">
        $(document).ready(function () {
            $('#OpenImage').click(() => {
                var image = new Image();
                image.src = $("#Result").val();
                var w = window.open("", 'Imagem Convertida');
                w.document.write('<title>Imagem Convertida</title>');
                w.document.write(image.outerHTML);
                if (win) {
                    //Browser has allowed it to be opened
                    win.focus();
                } else {
                    //Browser has blocked it
                    alert('Please allow popups for this website');
                }
            });
            $('#copyClipboard').click(() => {
                $("#Result").select();
                document.execCommand('copy');
                $('p#Copiado').text('Copiado para o clipboard');
            });
            $('#ConverterBtn').click(() => {
                var preview = document.querySelector('img');
                var file = document.querySelector('input[type=file]').files[0];
                var reader = new FileReader();
                var url = $('#urlArquivo').val();
                reader.onloadend = () => {
                    $('#Result').val(reader.result);
                    $("#arquivoUpload").val('');
                }
                if (file != null) {
                    reader.readAsDataURL(file);
                    $('p#Copiado').text(' ');
                }

                else if (url.length >= 1 && validURL(url)) {
                    var request = new XMLHttpRequest();
                    request.open('GET', "https://cors-anywhere.herokuapp.com/" + url, true);
                    request.responseType = 'blob';
                    request.setRequestHeader("Content-Type", "text/plain;charset=UTF-8");
                    request.setRequestHeader("Access-Control-Allow-Origin", "*");
                    request.onload = () => {
                        var reader = new FileReader();
                        reader.readAsDataURL(request.response);
                        reader.onload = (e) => {
                            $('#Result').val(e.target.result);
                        };
                    };
                    request.send();
                    $('p#Copiado').text(' ');
                }
                else
                    $('#Result').val('Selecione uma imagem');
            })
        });
    </script>
</body>

</html>
